# 轿厢壁板配合问题

1. 壁板有内面、外面、顶面、底面、左侧面、右侧面六个配合面。
2. 特征面的选择方法包括与基准面的关系和距离，比如与XY面平行且距离最近、与XZ面平行且距离最远。
3. 轿厢后壁由三块壁板组成，分别为左后壁、中间后壁、右后壁。
4. 轿厢后壁板之间的配合关系都是重合配合。
5. 重合配合有两种类型，默认是接触，第二种是平齐。
6. 轿厢后壁的左后壁的内面与中间后壁以及右后壁的内面平齐，轿厢后壁的左后壁的底面与中间后壁以及右后壁的底面平齐。
7. 轿厢后壁的左后壁的右面与轿厢后壁的中间后壁的左面接触，轿厢后壁的中间后壁的右面与轿厢后壁的右后壁的左面接触。
8. 壁板各面选择方法如下:{"内面"："parall-xz-nearest-face","外面"："parall-farthest_xz_face","顶面"："parall-farthest-xy-face","底面"："parall-xy-nearest-face","左面"："parall-yz-nearest-face","右面"："parall-farthest_yz_face"}.
9. 每个重合配合需要用配合名称、配合类型、第一个配合对象名称、第一个配合对象配合特征选择方法，第二个配合对象名称、第二个配合对象配合特征选择方法这几个参数来描述。左后壁内面与中间后壁内面平齐的配合记录为{"name":"左后壁-中间后壁-平齐"，"type":"平齐"，"part1_n":"左后壁","select_m":"parall-xz-nearest-face","part2_n":"中间后壁","select_m":"parall-xz-nearest-face"}。
10. 配合名称命名规则为配合连接1-配合连接2-配合类型，当两个零件有多个相同类型的配合时，增加三位数的序号。如左后壁-中间后壁-平齐001.
11. 所有后壁的配合保存到{"joints":[]}的数组中。

预期正确输出如下:
`{
  "joints": [
    {
      "name": "左后壁-中间后壁-平齐",
      "type": "平齐",
      "part1_n": "左后壁",
      "select_m1": "parall-xz-nearest-face",
      "part2_n": "中间后壁",
      "select_m2": "parall-xz-nearest-face"
    },
    {
      "name": "左后壁-右后壁-平齐",
      "type": "平齐",
      "part1_n": "左后壁",
      "select_m1": "parall-xz-nearest-face",
      "part2_n": "右后壁",
      "select_m2": "parall-xz-nearest-face"
    },
    {
      "name": "左后壁-中间后壁-平齐001",
      "type": "平齐",
      "part1_n": "左后壁",
      "select_m1": "parall-xy-nearest-face",
      "part2_n": "中间后壁",
      "select_m2": "parall-xy-nearest-face"
    },
    {
      "name": "左后壁-右后壁-平齐001",
      "type": "平齐",
      "part1_n": "左后壁",
      "select_m1": "parall-xy-nearest-face",
      "part2_n": "右后壁",
      "select_m2": "parall-xy-nearest-face"
    },
    {
      "name": "左后壁-中间后壁-接触",
      "type": "接触",
      "part1_n": "左后壁",
      "select_m1": "parall-yz-farthest-face",
      "part2_n": "中间后壁",
      "select_m2": "parall-yz-nearest-face"
    },
    {
      "name": "中间后壁-右后壁-接触",
      "type": "接触",
      "part1_n": "中间后壁",
      "select_m1": "parall-yz-farthest-face",
      "part2_n": "右后壁",
      "select_m2": "parall-yz-nearest-face"
    }
  ]
}`

已经有一个自动创建配合的脚本，可以接收{"joints":[]}对象，在装配体文件中添加配合约束。

# 壁板尺寸计算

1. 轿厢后壁由三块壁板组成。三块壁板的高度相等，中间壁板的宽度为700，左壁板和右壁板的宽度相等，三块壁板的总宽度等于轿厢内部宽度，轿厢壁板的高度等于轿厢内部高度。
2. 轿厢内部高度不超过2300时，壁板厚度为1.3，折弯高度为25，超过2300时壁板厚度为1.5，折弯高度为34.
3. 轿厢后壁中间壁板与左右壁板之间通过螺栓连接。壁板上的螺栓孔直径为10，左侧面和右侧面对称开孔，螺栓孔间距不超过300.
4. 单块壁板宽度超过500时需要条加强筋，超过300不超过500时需要一条加强筋，宽度300以下不需要加强筋。

根据以上规定，假设轿厢内部高度为2450，宽度为1500，计算每块轿厢壁板的尺寸，则预期轿厢壁板尺寸为:
{"轿厢后壁板尺寸":[{"壁板名称":"左后壁","壁板厚度":1.5,"折弯高度":34,"宽度":400,"高度":2450,"螺孔数量":14,"加强筋数量":1},[{"壁板名称":"中间后壁","壁板厚度":1.5,"折弯高度":34,"宽度":700,"高度":2450,"螺孔数量":14,"加强筋数量":2},[{"壁板名称":"右后壁","壁板厚度":1.5,"折弯高度":34,"宽度":400,"高度":2450,"螺孔数量":14,"加强筋数量":1}]}

# 简化壁板成本计算

1. 壁板成本包括材料成本和加工成本。材料成本，1.3厚度宽度500及以下为400，宽度500以上为600. 1.5厚度宽度500及以下为500，宽度500以上为800.
2. 加工成本包括折弯和开孔。每块壁板的折弯成本都是30. 开孔成本都是每孔0.5.

# 轿厢后壁板变更

当轿厢内部宽度大于2100时，由于单块壁板的宽度不能超过700，只能用4块或更多块壁板拼接成后壁板。对于宽度不超过2800的轿厢后壁板，显然轿厢后壁由4块壁板组成。轿厢后壁的中间后壁由一块变成两块，两块z中间后壁完全一样，在三维模型中的名称变为中间后壁和中间后壁001. 关于后壁的其余规则不变。即左右后壁的壁厚、折弯高度、开孔数量等规则可以继续复用。将两块中间壁板的三维模型视为一块中间壁板模型后，原有的轿厢后壁板配合规则也可以继续使用。

# 轿厢后壁三维模型创建

已经有一个实例化脚本，读取轿厢后壁配置json文件，根据配置中的壁板模板和实例化参数，读取壁板零件模板，修改模板参数，生成实例化壁板零件。然后根据轿厢后壁的Joints配置添加配合。


# 问题类型与求解方案

以上实际设计过程中各步骤和规则之间有明显的关联关系。对于


以上MVP还缺失了工作流推导和变更管理功能，也没有对功能实现进行分层，对于后续开发不利。我们需要提取领域问题中涉及到的实体、规则、流程，转换成KCE可接收的格式，将高内聚的操作表示为节点，将节点之间的关联关系如何创建表示为规则，KCE在给定的节点库和规则库基础上进行推导生成连接节点的边，生成节点图，根据问题的起始节点和期望终点节点，创建问题求解的流程图，执行流程图获取答案。 同样还可以根据节点库和规则库推导新增、修改、删除等对规则和实体的操作对关联实体和规则的影响。这些功能必须在初版MVP中规划好，否则会在完善功能使大改架构。请仔细考虑以上要求，是否还有可优化空间，然后重新规划MVP架构。

分层实现的一大好处是在底层实现后继续开发上层从而完善功能，不同层之间甚至可以定义好接口后并行实施。请进一步考虑KCE的架构，如何规划不同层之间的接口。

KEC与外部交互分两类，用户输入输出与外部服务调用。外部服务调用又分为外部独立服务和KCE可发起执行代码运行服务。外部独立服务如CAD软件提供的API，KCE连接到CAD然后调用API完成任务，KEC不负责CAD进程的维护，仅需要管理连接和输入输出。KCE可发起的服务如示例中壁板成本计算转换成的代码，KCE负责调用代码，输入参数获取结果。 每个节点和流程在运行时的状态和输入输出也是用户调试和判断规则、节点定义与运行情况的重要信息，必须以人类可读形式保存。 请根据这些要求，进一步细化KCE 架构

请根据示例说明，能否给出从起始节点到预期节点的自主推导过程示例说明，比如根据给定轿厢尺寸，自主推导后壁板数量、每个壁板的尺寸，总成本、壁板配合等。后壁板由3块变4块后哪些节点和规则可复用，如何添加或变更节点与规则以适配新变更，这些内容是否可以改写为用户故事，然后用于KEC的功能测试？